<?php
// Ensure the database connection is available
if (!isset($conn)) {
  die("Database connection is missing."); // Exit the script if the database connection is not initialized
}

// Check if the search variable is defined
if (!isset($search)) {
  die("Error: Undefined variable 'search'. Ensure it is defined before including this file."); // Exit if the 'search' variable is not defined
}

// Sanitize the input to prevent XSS attacks
$sanitized_search = htmlspecialchars($search, ENT_QUOTES, 'UTF-8');

// Flag to check if we need to apply the red background style
$apply_red_style = false;

// Check if the search contains a specific phrase or tag (for example, <style>...</style>)
if (strpos($sanitized_search, '<style>') !== false || strpos($sanitized_search, 'red') !== false) {
  $apply_red_style = true;
}

?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vulnerable Search</title>
  <?php if ($apply_red_style): ?>
    <style>
      body {
        background-color: red;
      }
    </style>
  <?php endif; ?>
</head>
<body>

<!-- Search Bar -->
<form method="GET" action="index.php" class="mb-4">
  <div class="input-group">
    <input type="text" name="search" class="form-control" placeholder="Search News..." value="<?= $sanitized_search; ?>">
    <div class="input-group-append">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
  </div>
</form>

<!-- Display Search Result -->
<?php
// Display sanitized search query
if (!empty($sanitized_search)) {
  echo "<div>You searched for: " . $sanitized_search . "</div>";
}
?>

</body>
</html>
