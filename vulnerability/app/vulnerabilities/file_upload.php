<?php
$upload_dir = __DIR__ . '/uploads/';

// Ensure the upload directory exists
if (!file_exists($upload_dir)) {
  mkdir($upload_dir, 0777, true);
}

// Process file upload
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['file'])) {
  $files = $_FILES['file'];

  // Create a container for the output messages
  echo '<div class="upload-result-container">';

  foreach ($files['name'] as $index => $file_name) {
    if (isset($file_name) && is_string($file_name) && !empty($file_name)) {
      $file_name = basename($file_name);  // Get the file name without path
      $target_path = $upload_dir . $file_name;  // Path where the file will be uploaded

      // We are intentionally NOT validating file extensions or MIME types.
      // This allows the upload of files like 'shell.php.jpg.jpg.jpg' (which could contain PHP code).

      // Move the uploaded file to the desired directory
      if (move_uploaded_file($files['tmp_name'][$index], $target_path)) {
        echo "<div class='alert alert-success'>
                <strong>Success!</strong> File '<strong>$file_name</strong>' uploaded successfully! <br>
                <a href='vulnerabilities/uploads/$file_name' target='_blank' class='file-link'>Click here to view the file</a>
              </div>";
      } else {
        echo "<div class='alert alert-danger'>
                <strong>Error!</strong> Failed to upload file '<strong>$file_name</strong>'.
              </div>";
      }
    } else {
      echo "<div class='alert alert-warning'>
              <strong>Warning!</strong> No file selected or invalid file name.
            </div>";
    }
  }

  echo '</div>';
}
?>

<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa;
    padding: 20px;
  }

  .upload-result-container {
    margin-top: 20px;
  }

  .alert {
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 5px;
  }

  .alert-success {
    background-color: #d4edda;
    border-color: #c3e6cb;
    color: #155724;
  }

  .alert-danger {
    background-color: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
  }

  .alert-warning {
    background-color: #fff3cd;
    border-color: #ffeeba;
    color: #856404;
  }

  .file-link {
    color: #007bff;
    text-decoration: none;
  }

  .file-link:hover {
    text-decoration: underline;
  }
</style>
