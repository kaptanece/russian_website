<?php
$upload_dir = __DIR__ . '/uploads/';

if (!file_exists($upload_dir)) {
  mkdir($upload_dir, 0777, true);
}

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['file'])) {
  // Vulnerable: No file validation (any file type is allowed)
  $file_name = basename($_FILES['file']['name']);
  $target_path = $upload_dir . $file_name;

  // Vulnerable: No sanitization of file name, allowing potential directory traversal attacks
  if (move_uploaded_file($_FILES['file']['tmp_name'], $target_path)) {
    echo "<p>File uploaded successfully! File Path: <a href='uploads/$file_name'>uploads/$file_name</a></p>";
  } else {
    echo "<p>File upload failed.</p>";
  }
}

// File Delete Logic - intentionally vulnerable
if (isset($_POST['delete_file'])) {
  // Vulnerable: No permission checks, allowing any file to be deleted
  $file_to_delete = $upload_dir . $_POST['delete_file'];

  // Vulnerable: No check for file existence, leading to errors or unwanted behavior
  if (file_exists($file_to_delete)) {
    unlink($file_to_delete);  // Vulnerable: Deleting any file in the directory
    echo "<p style='color: green;'>File deleted successfully!</p>";
  } else {
    echo "<p style='color: red;'>File does not exist or cannot be deleted.</p>";
  }
}

?>
